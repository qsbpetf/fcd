<template>
    <lightning-spinner if:true={isLoading} alternative-text="Loading" size="medium"></lightning-spinner>

    <lightning-card title={recordId} icon-name="custom:custom14">
        <div class="slds-grid slds-wrap">
            <lightning-textarea label="Paste your JSON below:" value={jsonText} onchange={updateJson} class="slds-m-around_x-small"></lightning-textarea>
            <lightning-file-upload
                    class="slds-m-around_x-small"
                    label="Upload JSON file from Atlassian Partner Portal"
                    name="fileUploader"
                    accept={acceptedFormats}
                    record-id={recordId}
                    onuploadfinished={handleUploadFinished}>
            </lightning-file-upload>
        </div>
        <div class="slds-grid slds-wrap">
            <lightning-input type="number" max-length="10"
                             pattern="[0-9]*\.?[0-9]*"
                             message-when-pattern-mismatch="Please enter a valid decimal number. Examples: 0.87236 1.234322 13.4545"
                             step="0.0000001"
                             label="Currency Conversion Factor"
                             value={conversionFactor}
                             onchange={updateConversionFactor}
                             class="slds-m-around_x-small"></lightning-input>
        </div>
        <lightning-button label="Show parsed product names" variant="brand" onclick={handleImport} class="slds-m-around_x-small"></lightning-button>
        <lightning-button label="Map products" variant="brand" onclick={handleMapping} class="slds-m-around_x-small"></lightning-button>
        <lightning-button label="Validate Opportunity Products" variant="brand" onclick={handleProducts} class="slds-m-around_x-small"></lightning-button>
        <lightning-button label="CREATE Opportunity Products!" variant="neutral" onclick={createProducts} class="slds-m-left_xx-large slds-m-top_x-small"></lightning-button>

        <div class="product-container">
            <h1>Found products:</h1>
            <ul class="custom-lis">
                <template for:each={data.orderItems} for:item="item">
                    <li key={item.productName}>{item.productName}</li>
                </template>
            </ul>
        </div>

        <div class="mapping-container">
            <h1>Found mappings:</h1>
            <div class="custom-lis">
                <template for:each={mapping} for:item="item">
                    <div class="rounded-rect" key={item.portalProduct}>
                        <div class="product-name">{item.portalProduct}</div>
                        <div>Found: {item.found}</div>
                        <div>Salesforce Product: {item.product.Name}, {template.Family}, {item.product.Id}</div>
                        <div>Info: {item.info}</div>
                    </div>
                </template>
            </div>
        </div>

        <div class="conv-result">
            <h1>Converted results:</h1>
            <div class="rounded-rect">
                <h2>Products</h2>
                <ul class="custom-lis">
                    <template for:each={conversionResult.productLog} for:item="log">
                        <li key={log}>{log}</li>
                    </template>
                </ul>
            </div>

            <div class="rounded-rect">
                <h2>Pricebook Entries</h2>
                <ul class="custom-lis">
                    <template for:each={conversionResult.pbeLog} for:item="log">
                        <li key={log}>{log}</li>
                    </template>
                </ul>
            </div>
        </div>
    </lightning-card>
</template>